'use client';

import { useState, useEffect } from 'react';

export default function SupportPage() {
  const [chatStartTime, setChatStartTime] = useState<number | null>(null);
  const [waitingTimer, setWaitingTimer] = useState<NodeJS.Timeout | null>(null);
  const [messageCount, setMessageCount] = useState(0);
  const [messages, setMessages] = useState([
    { type: 'system', text: '√údv√∂zl√ºnk a Szomsz√©dKos√°r √ºgyf√©lszolg√°lat√°n√°l! K√©rlek, √≠rd le a probl√©m√°dat, √©s munkat√°rsaink hamarosan v√°laszolnak.' }
  ]);
  const [inputValue, setInputValue] = useState('');
  const [showWaitingMessage, setShowWaitingMessage] = useState(false);
  const [chatDisabled, setChatDisabled] = useState(false);

  const [openFaq, setOpenFaq] = useState<number | null>(null);

  const faqItems = [
    {
      question: "Hogyan regisztr√°lhatok ≈ëstermel≈ëk√©nt?",
      answer: "Regisztr√°ci√≥ ut√°n a profilodban v√°laszd az \"≈êstermel≈ë\" opci√≥t, √©s t√∂ltsd fel a sz√ºks√©ges dokumentumokat. Ezut√°n korl√°tlanul haszn√°lhatod a platform √∂sszes funkci√≥j√°t."
    },
    {
      question: "Mennyibe ker√ºl a push √©rtes√≠t√©s?",
      answer: "Egy push √©rtes√≠t√©s 500 Ft-ba ker√ºl, ami c√©lzottan a megadott k√∂rzetben (10-30 km) ker√ºl kik√ºld√©sre. SimplePay rendszeren kereszt√ºl fizethetsz."
    },
    {
      question: "Mit jelent az \"alkalmi elad√≥\" korl√°toz√°s?",
      answer: "Alkalmi elad√≥k havonta maximum 5 hirdet√©st √©s 3 push √©rtes√≠t√©st adhatnak fel. Ez a NAV szab√°lyok betart√°sa v√©gett van √≠gy."
    },
    {
      question: "Hogyan m≈±k√∂dik a fizet√©s?",
      answer: "A platform ingyenes, csak a push √©rtes√≠t√©sek√©rt √©s h√≠rfolyam kiemel√©sek√©rt kell fizetni. SimplePay rendszeren kereszt√ºl bankk√°rty√°val vagy √°tutal√°ssal fizethetsz."
    }
  ];

  const toggleFaq = (index: number) => {
    setOpenFaq(openFaq === index ? null : index);
  };

  const startWaitingTimer = () => {
    if (waitingTimer) return;
    
    const timer = setTimeout(() => {
      setShowWaitingMessage(true);
      setMessages(prev => [...prev, {
        type: 'system',
        text: 'Minden munkat√°rsunk leterhelt. K√©rlek, k√ºldj emailt a support@szomszedkosar.hu c√≠mre!'
      }]);
      setChatDisabled(true);
    }, 5 * 60 * 1000); // 5 minutes
    
    setWaitingTimer(timer);
  };

  const sendMessage = () => {
    if (!inputValue.trim() || chatDisabled) return;
    
    setMessages(prev => [...prev, { type: 'user', text: inputValue }]);
    setInputValue('');
    setMessageCount(prev => prev + 1);
    
    // Start timer after first message
    if (messageCount === 0) {
      setChatStartTime(Date.now());
      startWaitingTimer();
      
      // Simulate thinking
      setTimeout(() => {
        setMessages(prev => [...prev, {
          type: 'system',
          text: 'K√∂sz√∂nj√ºk az √ºzeneted! Munkat√°rsaink hamarosan v√°laszolnak...'
        }]);
      }, 2000);
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter') {
      sendMessage();
    }
  };

  useEffect(() => {
    return () => {
      if (waitingTimer) {
        clearTimeout(waitingTimer);
      }
    };
  }, [waitingTimer]);

  return (
    <div style={{ fontFamily: 'Arial, sans-serif', backgroundColor: '#f8f9fa', minHeight: '100vh', padding: '20px' }}>
      {/* Simple Header */}
      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
        <div style={{ fontSize: '24px', marginRight: '10px' }}>üõí</div>
        <div style={{ fontSize: '20px', fontWeight: 'bold', marginRight: 'auto' }}>Szomsz√©dKos√°r</div>
        <div style={{ display: 'flex', gap: '20px' }}>
          <a href="#" style={{ color: '#007bff', textDecoration: 'underline' }}>üîç B√∂ng√©sz√©s</a>
          <a href="#" style={{ color: '#007bff', textDecoration: 'underline' }}>üìÑ H√≠rfolyam</a>
          <a href="#" style={{ color: '#007bff', textDecoration: 'underline' }}>Bejelentkez√©s</a>
          <a href="#" style={{ color: '#007bff', textDecoration: 'underline' }}>Regisztr√°ci√≥</a>
        </div>
      </div>

      {/* Page Title */}
      <div style={{ textAlign: 'center', marginBottom: '30px' }}>
        <h1 style={{ fontSize: '36px', marginBottom: '10px', color: '#333' }}>√úgyf√©lszolg√°lat</h1>
        <p style={{ color: '#666' }}>Seg√≠t√ºnk minden k√©rd√©sedben!</p>
      </div>

      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px', maxWidth: '1200px', margin: '0 auto' }}>
        {/* Chat Section */}
        <div style={{ border: '1px solid #ddd', padding: '20px', backgroundColor: 'white' }}>
          <div style={{ textAlign: 'center', marginBottom: '20px' }}>
            <h2 style={{ fontSize: '20px', marginBottom: '5px' }}>√âl≈ë Chat</h2>
            <p style={{ fontSize: '14px', color: '#666' }}>Besz√©lj vel√ºnk k√∂zvetlen√ºl</p>
          </div>

          {showWaitingMessage && (
            <div style={{ 
              backgroundColor: '#fff3cd', 
              border: '1px solid #ffeaa7', 
              padding: '10px', 
              marginBottom: '15px', 
              color: '#856404',
              textAlign: 'center'
            }}>
              ‚è∞ Minden munkat√°rsunk leterhelt. K√©rlek, k√ºldj emailt a support@szomszedkosar.hu c√≠mre, √©s hamarosan v√°laszolunk!
            </div>
          )}

          <div style={{ 
            border: '1px solid #ddd', 
            padding: '15px', 
            marginBottom: '15px', 
            height: '300px',
            backgroundColor: '#f9f9f9'
          }}>
            <div style={{ height: '250px', overflowY: 'auto', marginBottom: '10px' }}>
              {messages.map((message, index) => (
                <div key={index} style={{
                  padding: '8px 12px',
                  marginBottom: '10px',
                  borderRadius: '5px',
                  maxWidth: '80%',
                  backgroundColor: message.type === 'user' 
                    ? '#007bff' 
                    : message.type === 'system'
                    ? '#fff3cd'
                    : '#e9ecef',
                  color: message.type === 'user' ? 'white' : '#333',
                  marginLeft: message.type === 'user' ? 'auto' : '0',
                  marginRight: message.type === 'user' ? '0' : 'auto'
                }}>
                  {message.text}
                </div>
              ))}
            </div>
            <div style={{ display: 'flex', gap: '10px' }}>
              <input
                type="text"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyPress={handleKeyPress}
                disabled={chatDisabled}
                style={{
                  flex: 1,
                  padding: '8px',
                  border: '1px solid #ddd',
                  borderRadius: '3px',
                  backgroundColor: chatDisabled ? '#f5f5f5' : 'white'
                }}
                placeholder={chatDisabled ? "Chat lez√°rva - haszn√°ld az email t√°mogat√°st" : "√çrd ide az √ºzeneted..."}
                maxLength={500}
              />
              <button
                onClick={sendMessage}
                disabled={chatDisabled}
                style={{
                  padding: '8px 15px',
                  backgroundColor: chatDisabled ? '#6c757d' : '#007bff',
                  color: 'white',
                  border: 'none',
                  borderRadius: '3px',
                  cursor: chatDisabled ? 'not-allowed' : 'pointer'
                }}
              >
                K√ºld√©s
              </button>
            </div>
          </div>
        </div>

        {/* Contact Section */}
        <div>
          <h2 style={{ fontSize: '20px', marginBottom: '20px' }}>Kapcsolat</h2>
          
          <div style={{ marginBottom: '30px' }}>
            <div style={{ 
              display: 'flex', 
              alignItems: 'center', 
              gap: '10px', 
              marginBottom: '15px', 
              padding: '15px',
              border: '1px solid #ddd',
              backgroundColor: 'white'
            }}>
              <div style={{ fontSize: '20px' }}>üìß</div>
              <div>
                <h3 style={{ margin: 0, fontSize: '16px' }}>Email Support</h3>
                <p style={{ margin: 0, fontSize: '14px', color: '#666' }}>support@szomszedkosar.hu</p>
              </div>
            </div>
            
            <div style={{ 
              display: 'flex', 
              alignItems: 'center', 
              gap: '10px', 
              marginBottom: '15px', 
              padding: '15px',
              border: '1px solid #ddd',
              backgroundColor: 'white'
            }}>
              <div style={{ fontSize: '20px' }}>‚ö°</div>
              <div>
                <h3 style={{ margin: 0, fontSize: '16px' }}>V√°laszid≈ë</h3>
                <p style={{ margin: 0, fontSize: '14px', color: '#666' }}>24 √≥r√°n bel√ºl v√°laszolunk</p>
              </div>
            </div>
            
            <div style={{ 
              display: 'flex', 
              alignItems: 'center', 
              gap: '10px', 
              marginBottom: '15px', 
              padding: '15px',
              border: '1px solid #ddd',
              backgroundColor: 'white'
            }}>
              <div style={{ fontSize: '20px' }}>üïí</div>
              <div>
                <h3 style={{ margin: 0, fontSize: '16px' }}>√úgyf√©lfogad√°s</h3>
                <p style={{ margin: 0, fontSize: '14px', color: '#666' }}>H√©tf≈ë-P√©ntek: 9:00-17:00</p>
              </div>
            </div>
          </div>

          {/* FAQ Section */}
          <div>
            <h3 style={{ fontSize: '18px', marginBottom: '15px' }}>Gyakori K√©rd√©sek</h3>
            
            <div>
              {faqItems.map((item, index) => (
                <div key={index} style={{ border: '1px solid #ddd', marginBottom: '5px', backgroundColor: 'white' }}>
                  <div 
                    style={{
                      padding: '15px',
                      cursor: 'pointer',
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      fontWeight: '500'
                    }}
                    onClick={() => toggleFaq(index)}
                  >
                    {item.question}
                    <span style={{ fontSize: '18px' }}>{openFaq === index ? '-' : '+'}</span>
                  </div>
                  {openFaq === index && (
                    <div style={{ padding: '0 15px 15px', fontSize: '14px', color: '#666', lineHeight: '1.5' }}>
                      {item.answer}
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}